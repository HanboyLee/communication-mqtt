# WebSocket/MQTT Chrome Extension - 项目概述

## 项目简介

这是一个基于 Chrome Manifest V3 的浏览器扩展，通过 Side Panel API 提供一个功能完整的 WebSocket 和 MQTT 调试工具。扩展支持两种协议模式，提供多主题标签页、消息日志、连接历史、空闲超时自动断开和主题切换等功能。

## 核心特性

### 1. 双协议支持
- **WebSocket 模式**: 原生 WebSocket 连接，支持 `ws://` 和 `wss://` 协议
- **MQTT-over-WebSocket 模式**: 使用 MQTT.js 库实现 MQTT v3.1.1 协议

### 2. 多主题标签页系统 ⭐ 新功能
- **同时订阅多个主题**: 支持 MQTT 多主题同时订阅和查看
- **标签页管理**: 通过标签页切换查看不同主题的消息
- **独立会话**: 每个主题独立的日志、过滤器和配置
- **主题匹配**: 支持通配符订阅（`+` 单级，`#` 多级）
- **会话工具栏**: 每个会话独立的清空、导出、暂停功能
- **主题管理面板**: 统一管理所有订阅主题

### 3. 连接管理
- 快速连接/断开切换
- 连接状态可视化指示器（断开/连接中/已连接）
- URL 手动输入或通过配置面板构建
- 自动重连选项（MQTT 模式）

### 4. 消息功能
- 实时消息发送与接收
- JSON 格式化显示
- 消息历史记录（可配置 1-50 条）
- 历史消息快速填充（Chips）
- 消息路由（自动分发到匹配的主题会话）

### 5. 日志系统
- 分类显示：接收（rx）/ 发送（tx）/ 系统（sys）
- 时间戳记录
- 自动滚动（可锁定）
- 清空日志功能
- 聊天气泡样式界面
- 会话级别的日志过滤
- 日志大小限制（默认 1000 条/会话）

### 6. MQTT 专属功能
- 客户端 ID 自定义
- 用户名/密码认证
- 多主题订阅/发布
- 通配符主题支持（`+`, `#`）
- 独立的发布主题配置
- QoS 等级选择（0/1/2）

### 7. 界面特性
- Light/Dark 主题切换
- 毛玻璃（Glassmorphism）UI 设计
- 响应式布局
- 自定义滚动条样式
- 滑入式高级配置面板
- 标签页导航栏

### 8. 键盘快捷键 ⭐ 新功能
| 快捷键 | 功能 |
|--------|------|
| `Ctrl + Tab` | 切换到下一个标签 |
| `Ctrl + Shift + Tab` | 切换到上一个标签 |
| `Ctrl + 1-9` | 切换到指定编号的标签 |
| `Ctrl + W` | 关闭当前标签 |
| `Ctrl + T` | 添加新主题 |
| `Ctrl + ,` | 打开主题管理面板 |

### 9. 无障碍访问
- ARIA 标签支持
- 键盘导航完整支持
- 屏幕阅读器兼容
- 焦点管理

### 10. 自动化功能
- 空闲超时自动断开（可配置秒数）
- 状态持久化（chrome.storage.local）
- 配置自动保存
- 主题配置保存和恢复

## 技术栈

| 类别 | 技术 |
|------|------|
| 扩展平台 | Chrome Extension Manifest V3 |
| 构建工具 | Vite 5.2.0 |
| JavaScript | ES6+ (模块化) |
| MQTT 库 | MQTT.js 5.3.6 |
| 图标 | Font Awesome 6.5.1 |
| 字体 | Inter (UI), JetBrains Mono (代码) |
| CSS | 自定义 CSS + CSS 变量主题系统 |

## 用户界面布局

```
┌─────────────────────────────────────────────┐
│  ● URL 输入框  [连接] [设置]                 │  ← Header
│  主题输入  [空闲] [历史] [清空] [锁定] [主题] │
├─────────────────────────────────────────────┤
│  ┌─ home/temp ─┬─ sensor/# ─┬─ + ─┬─ ⚙ ─┐ │  ← Tab Bar
├─┴─────────────┴─────────────┴─────┴─────┤────┤
│  [清空] [导出] [暂停] [过滤] [配置] | 12 条 │  ← Session Toolbar
├─────────────────────────────────────────────┤
│                                             │
│  [接收消息]            [发送消息]           │  ← Log Area
│  [接收消息]            [发送消息]           │     (当前标签)
│  系统消息                                   │
│                                             │
├─────────────────────────────────────────────┤
│  [历史1] [历史2] [历史3]                    │  ← Footer
│  [消息输入框...........................] [发送] │
└─────────────────────────────────────────────┘
```

## 多主题使用场景

1. **Home Assistant 监控**: 同时监控多个设备的传感器数据
   - `homeassistant/sensor/temperature/state`
   - `homeassistant/sensor/humidity/state`
   - `homeassistant/binary_sensor/door/state`

2. **AWS IoT 调试**: 监控设备影子主题
   - `$aws/things/device1/shadow/update`
   - `$aws/things/device1/shadow/update/accepted`

3. **系统监控**: 同时查看系统消息和应用消息
   - `$SYS/broker/#` (系统消息)
   - `app/#` (应用消息)

## 权限说明

扩展需要以下 Chrome 权限：

- `storage`: 用于保存用户配置、历史记录和主题设置
- `sidePanel`: 用于启用侧边栏面板功能

## 文件输出

构建后生成的 `dist/` 目录结构：

```
dist/
├── sidepanel.html          # 主页面
├── assets/
│   ├── sidepanel-[hash].js   # 打包后的 JavaScript
│   └── sidepanel-[hash].css  # 打包后的 CSS
├── icons/                  # 扩展图标
└── manifest.json           # Chrome 扩展清单
```

## 使用场景

1. **WebSocket 开发**: 调试 WebSocket 服务器连接和消息
2. **IoT 开发**: 测试 MQTT over WebSocket 连接（如 Home Assistant, AWS IoT）
3. **实时通信测试**: 验证推送消息格式和内容
4. **协议学习**: 理解 WebSocket 和 MQTT 的工作原理
5. **多设备监控**: 同时监控多个 IoT 设备的状态和消息
